const request = require("supertest");
const express = require("express");
const bodyParser = require("body-parser");
const controller = require("../controllers/controller");

const app = express();
app.use(bodyParser.urlencoded({ extended: true }));
app.use("/", controller);

describe("POST /scan", () => {
    it("should detect an open redirect vulnerability", async () => {
        const res = await request(app)
            .post("/scan")
            .send({ url: "http://example.com/example?redirect=http://malicious.com" });
        expect(res.text).toContain("Found");
    });

    it("should not detect an open redirect vulnerability", async () => {
        const res = await request(app)
            .post("/scan")
            .send({ url: "http://example.com/safe" });
        expect(res.text).toContain("Not Found");
    });
});
